<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--
******************************************************************************
*
******************************************************************************
-->

<html>
<head>
  <title>Calibration Run <?=$gRunId?>: Summary and Fast Offline Results</title>
  <link REL="STYLESHEET" TYPE="text/css" HREF="main.css">
</head>

<body bgcolor="#ffffff">

<p>

<table border="0" cellpadding="0" cellspacing="0" align="center" width="100%">
<tr>
<td width="10%">

<td width="80%">

<!-- Main text starts here-->

<p><a name="content"/>

<h1 class="count">Calibration Run <?=$gRunId?></h1>

<p>
<a href="./index.php"><span class=s150>Run Index</span></a>


<div style="text-align: right;"><a href="#content">Table Of Contents</a></div>
<h2 id="summary" class="count">Summary</h2>
<!-- {{{ -->
<div id="div:summary" class="section">

<p>

<table border="1" cellpadding="3" cellspacing="0" align="center" width="100%">
<tr>
   <td>
   <b>Run Start Time:</b> <?=date("M j, Y H:i:s", $rc['StartTime'])?>
   <td>
   <b>Total Events:</b> <?=number_format($rc['nEventsTotal'])?>
   <td>
   <b>Beam Energy:</b> <?=sprintf("%10.3f", $rc['BeamEnergy'])?>&nbsp;GeV
   <td>
   <b>Active Strips:</b> <?=$rc['NActiveStrip']?>
   <!--
   <td>
   <b>Size:</b> <?//=$s['dirsize']?>
   -->

<tr>
   <td>
   <!--<b>Run End Time:</b> <?//=date("M j, Y H:i:s", $rc['StopTime'])?>-->
   <b>Processed Offline:</b> <?=date("M j, Y H:i:s", $rc['procDateTime'])?>&nbsp;
   (<?=sprintf("%.0f", $rc['procTimeReal']);?>&nbsp;s)
   <td>
   <b>Events Processed:</b> <?=number_format($rc['nEventsProcessed'])?>
   <? if ($rc['thinout'] > 1): ?>(every <?=ordinal_suffix($rc['thinout'])?> event)
   <? endif; ?>
   <td>
   <b>Target ID:</b> <?=$rc['targetID']?>
   <td>
   <b>Disabled Strips:</b> <?=$rc['NDisableStrip']?>

<tr>
   <td colspan=4>
   <b>Channels:</b><br>

   <table border="1" cellpadding="0" cellspacing="0" align="center" width="100%">
   <?php
      $row1 = ""; $row2 = "";

      foreach($rc['ActiveStrip'] as $chanId => $siS) {

         $chanId += 1;

         $row1 .= "<td><a href=./?runid=$gRunId&chanid=$chanId>$chanId</a>";
         //$row2 .= "<td>".($siS ? "x" : "o");

         if (($chanId) % 36 == 0) {
            //print "<tr class=align_cm>$row1\n<tr class=align_cm>$row2";
            print "<tr class=align_cm>$row1\n";
            $row1 = "";// $row2 = "";
         }
      }
   ?>
   </table>

</table>


<div style="text-align: right;"><a href="#content">Table Of Contents</a></div>
<h3 id="calibconst" class="count">Constants</h3>
<!-- {{{ -->
<div id="div:calibconst" class="section">

<p>

<table border="1" cellpadding="2" cellspacing="0" align="center" width="">
<?php

$nColumns  = 2;
$nChannels = $rc['NActiveStrip'];
$nRows     = ceil($nChannels/$nColumns); 

for ($ir=0; $ir<$nRows; $ir++) :
//foreach($rc['data']['chan'] as $chanId => $coefs):

   if ($ir == 0) {
      print "<tr class=align_cm>\n";
      for ($ic=0; $ic<$nColumns; $ic++) {
         print "<th>Ch\n";
         print "<th>A, keV/ADC\n";
         print "<th>&Delta;A\n";
         print "<th>I, keV/ADC\n";
         print "<th>&Delta;I\n";
         print "<th>&nbsp;&nbsp;&nbsp;&nbsp;\n";
      }
   }

   print "<tr class=align_cm>\n";

   for ($ic=0; $ic<$nColumns; $ic++) :

      $chanId = $ic*$nRows + $ir;
      $coefs = $rc['calib'][$chanId];

      if ($chanId > $nChannels) continue;

      $chanId += 1;
      print "<td>$chanId\n";
      print "<td class=align_r>".sprintf("%7.4f", $coefs['ACoef'])."\n";
      print "<td class=\"align_r ".($coefs['ACoefErr']<0?"feature":"")."\">".sprintf("%7.4f", $coefs['ACoefErr'])."\n";
      print "<td class=align_r>".sprintf("%7.4f", $coefs['ICoef'])."\n";
      print "<td class=\"align_r ".($coefs['ICoefErr']<0?"feature":"")."\">".sprintf("%7.4f", $coefs['ICoefErr'])."\n";
      print "<td>&nbsp;&nbsp;\n";

   endfor;
endfor;
?>
</table>

<p>

<table border="1" cellpadding="5" cellspacing="2" align="center" width="100%">
<tr>
<td align=center>
<?=$gP->img('hACoef')?>
<td align=center>
<?=$gP->img('hICoef')?>
</table>

</div>
<!-- }}} -->


<div style="text-align: right;"><a href="#content">Table Of Contents</a></div>

<h2 id="summary_plots" class="count">Summary Plots</h2>
<!-- {{{ -->
<div id="div:summary_plots" class="section">

<p>

<table border="1" cellpadding="5" cellspacing="2" align="center" width="100%">

<tr>
<td align=center>
<?=$gP->img('hAmpltd')?>
<td align=center>
<?=$gP->img('hAmpltd_cut1')?>
<td align=center>
<?=$gP->img('hAmpltdW')?>
<tr>
<td align=center>
<?=$gP->img('hIntgrl')?>
<td align=center>
<?=$gP->img('hIntgrl_cut1')?>
<td align=center>
<?=$gP->img('hIntgrlW')?>
<tr>
<td align=center colspan=3>
<?=$gP->img('hTdc')?>
<tr>
<td align=center>
<?=$gP->img('hTvsA')?>
<td align=center>
<?=$gP->img('hTvsI')?>
<td align=center>
<?=$gP->img('hIvsA')?>


</table>

</div>
<!-- }}} -->


<div style="text-align: right;"><a href="#content">Table Of Contents</a></div>

<h2 id="channels" class="count">Channel Plots</h2>
<!-- {{{ -->
<div id="div:channels" class="section">

<p>

<table border="1" cellpadding="0" cellspacing="0" align="center" width="100%">
<?php

foreach($rc['ActiveStrip'] as $chanId => $siS) {

   $chanId += 1;

   $chanId = sprintf("%02d", $chanId);
   $gP->dir = "./$gRunId/images/channel$chanId/";

   //$row1 .= "<td><a href=./?runid=$gRunId&chanid=$chanId>$chanId</a>";
   //$row2 .= "<td>".($siS ? "x" : "o");

   if ( ($chanId-1) % 6 == 0 ) {
      //print "<tr class=align_cm>$row1\n<tr class=align_cm>$row2";
      print "<tr class=align_cm>\n";
      //$row1 = "";// $row2 = "";
   }

   $img = $gP->img("hAmpltd_cut1_st$chanId", 150);
   print "<td>$img\n";
   
}
?>
</table>

</div>
<!-- }}} -->


<!--
<p>

<div style="text-align: right;"><a href="#content">Table Of Contents</a></div>
<h2 id="misc" class="count">Misc</h2>

<table border="1" cellpadding="5" cellspacing="2" align="center" width="100%">

<tr>
<td align=center>
<td align=center>

</table>
-->

<!-- Main text ends here-->

<td width="10%">

<tr>
<td width="10%">

<td width="80%">

<p>&nbsp;<br>
<hr width="100%" size="2">

<div align="left">
</div>

<td width="10%">

</table>

</body>
</html>
